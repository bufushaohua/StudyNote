## Redis

### Nosql概述

> 1.单机MySQL的年代

![image-20200801121610135](C:\Users\CYC\AppData\Roaming\Typora\typora-user-images\image-20200801121610135.png)

90年代，一个基本的网站访问量一般不会太大，单个数据库完全足够！

那个时候，更多的去使用静态网页Html  服务器根本没有太大的压力！

:question: 这种情况下，整个网站的瓶颈是什么？

1. 数据量如果太大，一个机器放不下了！
2. 数据的索引（B+ Tree）300万就一定要建立索引！
3. 访问量（读写混合），一个服务器承受不了

只要你开始出现以上的三种情况之一，那么你就必须要晋级！

> 2.Memcached（缓存） + MySQL + 垂直拆分

网站80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦，所以说我们希望减轻数据的压力，我们可以使用缓存来保证效率！

发展过程： 优化数据结构和索引 ---> 文件缓存（IO） ----> Memcached（当时最热门的技术！）

![image-20200801125144529](C:\Users\CYC\AppData\Roaming\Typora\typora-user-images\image-20200801125144529.png)

> 3.分库分表 + 水平拆分 + MySQL集群

技术和业务在发展的同时，对人的要求也越来越高！

==本质：数据库（读，写）==

早些年MyISAM：表锁，十分影响效率！高并发下就会出现严重的锁问题

转战Innodb：行锁

慢慢的就开始使用分库分表来解决写的压力！MySQL在那个年代推出了 表分区 ！这个并没有很多公司使用



### 为什么要用NoSQL

> 4.如今最近的年代

MySQL等关系型数据库就不够用了！数据量很多，变化很快！

MySQL有点使用它来存储一些比较大的文件，博客，图片！数据库表很大，效率就低了！如果偶一种数据库来专门处理这种数据。MySQL压力就变得十分小（研究如何处理这些问题！）大数据的IO压力下，表几乎没法更大！

> 目前一个基本的互联网项目！

![image-20200801160351829](C:\Users\CYC\AppData\Roaming\Typora\typora-user-images\image-20200801160351829.png)

> 为什么要用NoSQL！

用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！

这时候我们就需要使用NoSQL数据库的，NoSQL可以很好的处理以上的情况！



### 什么是NoSQL

> NoSQL

==NoSQL = Not  Only  SQL（不仅仅是SQL）==

关系型数据库： 表格，行，列（POI：用Java程序 POI Jar包可以操作Excel文件）

泛指非关系型数据库，随着Web2.0互联网的诞生！传统的关系型数据库很难对付Web2.0时代！尤其是超大规模的高并发的社区！暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的，是当下必须要掌握的一个技术！

很多的数据类型用户的个人信息，社交网络，地理位置。这些数据类型的存储不需要一个固定的格式！不需要多余的操作就可以横向扩展的！ Map<String,Object> 使用键值对来控制！

> NoSQL特点

解耦！

1. 方便扩展（数据之间没有关系，很好扩展！）
2. 大数据量高性能（Redis一秒写8万次，读取11万）
3. 数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据量十分大的表，很多人就无法设计了！）
4. 传统RDBMS和NoSQL

~~~
传统的RDBMS
- 结构化组织
- SQL
- 数据和关系都存在单独的表中
- 操作操作，数据定义语言
- 严格的一致性
- 基础的事务
- .......
~~~

~~~
NoSQL
- 不仅仅是数据
- 没有固定的查询语言
- 键值对存储，列存储，文档存储，图形数据库（社交关系）
- 最终一致性
- CAP定理 和 BASE （异地多活！）  ---初级架构师
- 高性能，高可用，高可扩！
- .........
~~~

> 了解： 3V+ 3高

大数据时代的3V：主要是描述问题的：

1. 海量Volume
2. 多样Variety
3. 实时Velocity

大数据时代的3高：主要是对程序的要求

1. 高并发
2. 高可拓
3. 高性能

 

大型互联网应用问题：

- 数据类型太多了！
- 数据源繁多，经常重构！
- 数据要改造，大面积改造！

解决方案：搭建UDSL（统一数据服务平台，作用就和JDBC一样）



### NoSQL的四大分类

**KV键值对：**

- 新浪：Redis
- 美团：Redis + Tair
- 阿里、百度：Redis +  Memecache

**文档型数据库（bson格式 和 Json一样）:**

- MongoDB（一般必须要掌握）
  - MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档！
  - MongoDB是一个介于关系型数据库和非关系型数据中中间的产品！MongoDB是非关系型数据库中功能最丰富，最像关系型数据库的！
- ConthDB

**列存储数据库：**

- HBASE
- 分布式文件系统

**图关系数据库：**

- 他不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐！
- Neo4j，InfoGrid



> 四者对比

![image-20200801173331558](C:\Users\CYC\AppData\Roaming\Typora\typora-user-images\image-20200801173331558.png)



### Redis入门

> #### Redis是什么？

Redis（Remote Dictionary Server )，即远程字典服务

是一个开源的使用ANSI [C语言](https://baike.baidu.com/item/C语言)编写、支持网络、可基于内存亦可持久化的日志型、Key-Value[数据库](https://baike.baidu.com/item/数据库/103728)，并提供多种语言的API。

![image-20200801174216504](C:\Users\CYC\AppData\Roaming\Typora\typora-user-images\image-20200801174216504.png)

免费和开源！是当下最热门的NoSQL技术之一！也被人们称之为结构化数据库！

> #### Redis 能干嘛？

1. 内存存储、持久化，内存中是断电即失，所以持久化很重要（rdb、aof）
2. 效率高，可以用于高速缓存
3. 发布订阅系统
4. 地图信息分析
5. 计时器、计数器（浏览量！）
6. .......

> #### 特性

1. 多样的数据类型
2. 持久化
3. 集群
4. 事务 
5. .....

>#### Redis的两种不同形式的持久化方法

1. 时间点转储

   转储操作既可以在“指定时间段内有指定数量的写操作执行”这一条件被满足时执行，又可以通过调用两条转储到硬盘命令中的任何一条来执行

2. 将所有修改了数据库的命令都写入一个只追加文件里，用户可以根据数据的重要程度，将只追加写入设置为从不同步、每秒同步一次或者每写入一个命令就同步一次

> #### Redis主从复制特性

​		执行复制的从服务器会连接上主服务器，接受主服务器发送的整个数据库的初始副本；之后主服务器执行的写命令，都会被发送给所有连接着的从服务器去执行，从而实时的更新从服务器的数据集









