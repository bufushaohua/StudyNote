# 资源整合

## 公共学习经验

~~~Markdown
渠道通讯码查看：
	both.constant.IBSPConst
	trade.base.communication.CommunicationFactory

外设输入密码键盘框
	lib.client.device.readpinui
	
	trade.core.util.ZjnxUtil
	
公共的yuda文件（打印用的上）：
		1.both.commoncontext.TellerInfo.yuda
		2.trade.base.commontrade.CommonTrade.yuda		
		

cpdt：对于组合项返回的是id而不是数据值，
直接点该打印项，属性里有转换参数选择DataSource，DataSource数据源，去xml找匹配项，没有就自己建一个

trade.base.commontrade.CommonTrade


打版路径：F:\zhqd\12-版本更新\02UAT更新\01开发更新列表\文件名
资源

报文类型为03-分隔符   走的是TCP，需要配置mapping


SVN checkout：SVN检出  
URL of Respository:   svn://158.222.65.84:3691/zhqd

测试联系单如果需求单的所属项目为我们综合前端的话那就我们来建，如果是其他项目组的话就他们来建


联社号  自岗位

地区码查看：路径	/zjrc/src/trade/core/util/ZjnxMidUtil.java

获取代理单位编号(省级中心业务)：QueryUtil.get_sun_entr_center(this, "FINPAY");

获取一户通单位编号：QueryUtil.get_sun_entr_local(this, "FINPAY")
~~~



### 插件包更新

暴力解决：

1. 先覆盖lib
2. 再覆盖.classpath
3. 最后覆盖plugin插件包



### 上线操作

1. 资源整理一下
2. 数据库有更新的，在验证环境处理好。然后把select语句放txt文件属上名字，给到周芳琴周老师。交易新增授权的要和周老师说一下
3. 授权你就写下，哪个交易有授权，强制授权还是条件授权，条件授权的话条件是新的还是老的
4. 然后就是验证环境不要有多余的数据

做需求之前可以先去准生产环境看一下

公共资源要单独整理出来

提交的资源必须是自己修改过的东西

### 打版操作

1. 先确保无误且测试环境通过后，整理所有用到的文件，包括BIp 4种文件、BSP 3种文件以及打印的两种文件，必要的话还要加上映射文件（有就一定要打版）以及公共资源
2. 将上述所有文件上传到svn上，并标注相关信息
3. 先在打版路径：F:\zhqd\12-版本更新\02UAT更新\01开发更新列表下更新svn，再在后面按样式新建一个文件夹，将所有资源整理成xls文件，放入该文件夹下
4. 然后联系周扬莉老师，把打版文件所在路径发给他就OK

> 注：如果还要打版，要重新进行上述步骤，没有变动的文件也要加上



一些公共资源在上线的时候会更改svn版本，这个版本不同于开发版本，开发的时候要回退到上一个最新版本



### 准生产验证查看

准生产不用测，只要打开交易试一试界面逻辑就行，到核心的是可以测得



### 省版交易配置

（测试环境随便配一个999无所谓的，上生产的话具体都要业务确认 不要自作主张就可以了）

必须在select * from BTOP_TELLER_BANKMENUCODE where MENUCODE = '50362B';

![image-20201010154116095](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201010154116095.png)

![image-20201010154220991](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201010154220991.png)

999加这个字段为1才为任意字段都可以



### 交易授权

![image-20201021101840423](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201021101840423.png)

> 金额类授权

参考交易：trade.creditCardSystem.t004606.T004606   IC卡信用卡取款

> 字符串比对授权





验证环境具有授权权限交易的柜员：

~~~sql
# 查询语句
select distinct t.* from BTOP_TELLER_ROLEMENUCODE r,BTOP_TELLER_TELLERINFO t, BTOP_TELLER_POSTROLEMAPPING p
where 1=1 -- r.menucode=''
and r.roleid = p.roleid
and p.postid = t.postid
and t.orgid like '999%'
and r.menucode='F00201'
~~~

![image-20201027101116413](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201027101116413.png)

具有对授权交易进行授权的柜员号：9990021

tellertype数字越大级别越高

### 02-xml报文

  参考报文503092.sod  参考交易：503071,509974，503031 

1. xml报文没有mapping映射

2. 请求报文和应答报文有相同字段名时，创建时两个报文的分组一样都为接口字段名，但分组中的字段一定要不一样，因为前端传送数据到后台是将请求报文和应答报文一起传给后台，后台再将数据插入到应答报文返回回来

3. 远程查询是通过：

~~~Java
	//查询代理单位编号
	// sql语句需要后台提供
	String sql = "select entr_no, entr_name from t_entr where busi_no='QZLLT'";
	String[] rowsData = ZjnxMidUtil.Remote_TcpQuery3(this, sql, "", "73", // 73是新平台交易对应的交易码是503开头 ，79就是对应509，自己选
			"hpgenl");
	if (rowsData != null && rowsData.length != 0) {
		cb_winIn_HIBSSTR1_代理单位编号.clear();
		String[] item = new String[2];
		for (int i = 0; i < rowsData.length; i++) {
			item = rowsData[i].split("[|]", -1);
			cb_winIn_HIBSSTR1_代理单位编号.addItem(item[0], item[1], item[0]);
		}
		cb_winIn_HIBSSTR1_代理单位编号.setFocus();
	
	} else {
	showInfo("单位编号未配置,请和管理员联系!");
	exit(0);
~~~


​	
4. 查询本地数据库中70~74
    select PARA_VAL1,PARA_NAME from ZJRC_SUN_PARA where PARA_TYPE = '1' and PARA_NO = 'AREACODE'



### 03-分隔符报文

​	走的是TCP，需要配置mapping

![image-20201016094640365](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201016094640365.png)



### 凭证回单打印时间精确到秒

舟山资金监管

参考交易路径	/zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620/T503620.java

~~~JAVA
SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss");
		Long logtime = this.requestService("zjrc/pubservice/timeService", "",
				Long.class);
		Date date = new Date(logtime);
		String time = sdf.format(date);
		set_print_printTime(TellerInfo.get_WorkDate() + " " + time);
~~~





### 分页打印

~~~java
// 参考路径：trade.settleSys.querybusi.t003845.T003845

public boolean postSubmit(CommResponse commResponse) throws Exception {
		// TODO Auto-generated method stub
		
		Map<String, Object> importVar = new HashMap<String, Object>();
		Map<String, Object> dataMap = new HashMap<String, Object>();
		if ("1".equals(combobox_票据类型.getSelectedId())|| "2".equals(combobox_票据类型.getSelectedId())) {
			importVar.put("ALLDATA", this.get_718010Out_BRO80111());
		} else {
			importVar.put("ALLDATA", this.get_713720Out_BRO37201());
		}
		importVar.put("PAGESIZE", "40");
		ZjrcPrintUtil.selectPagePrint(this, importVar, dataMap);
		List list = new ArrayList();
		if ("1".equals(combobox_票据类型.getSelectedId())) {
			list.add("纸质银行承兑汇票承兑清单");
		} else {
			list.add("电子商业汇票承兑清单");
		}

		PrintUtil.print(this, "0038450001.cpdt", list, dataMap);
		return true;
	}
~~~

### 数据表（菜单交易码）
| 数据表                   | 表名             | 备注                   |
| ------------------------ | ---------------- | ---------------------- |
| BTOP_TELLER_MENUTREE     | 菜单信息表       | 用于关联前端代码与菜单 |
| BTOP_TELLER_ROLEMENUCODE | 子岗位交易对照表 | 用于配置前端交易权限   |
| BTOP_TELLER_BANKMENUCODE | 联社交易码表     | 用于配置交易开放的联社 |
| ZJRC_SUN_PARA            | 配置表           | 用于配置征收机名称     |

### 日期比较

~~~java
public void dt_50201BIn_CLEARDATE_清算日期_onBlur() throws Exception {
		if (DateUtil.getRemainingdays(dt_50201BIn_CLEARDATE_清算日期.getDateString(), TellerInfo.get_WorkDate().replaceAll("-", "")) < 0){
			dt_50201BIn_CLEARDATE_清算日期.setFocus();
			this.showInfo("日期不能大于当前日期");
		}
	}
~~~

服务器监听端口：

FTP::158.222.65.164\//home/btop/BIPS_A/var/config|config-substitutions.properties



### 柜员号

> #### 授权

9990010   9990009    9990015

> #### 准生产

8010917

舟山交易：8011218



### 前端bug

1. ![image-20201022162319284](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201022162319284.png)

![image-20201022162340670](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201022162340670.png)

2. 

## 一、电票代签需求开发

		参考交易：trade.middle.localmid.wz.lucheng.t503098 开阳水费单笔缴费
	
	修改需求
		交易码：003845  银承汇票清单打印
		!StringUtilEx.isNullOrEmpty(pwdType)：判断是否不为null
		
		所用到的文件：
	
		1.用水信息查询
		BSP:
			发送报文：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\503408\RQDTL.mfd
			接收报文：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\503408\RSP_503408.mfd
			sod文件：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_middle_sod\operations\503408.sod
	
		BIP:
			trade.settleSys.querybusi.t003845 （四个文件）


​	 
​	    
​		t_503408In_BkEntrNo_代理单位管理编号
​		503408In_BkEntrNo
## 二、校园缴费业务需求开发

~~~sh
# 资源整理
在原交易上添加超级管理员，提供新增、删除、查询功能

参考交易：trade.middle.localmid.hz.fuyang.xmlmiddle.t503130

BSP：
	发送报文：
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\ZJYW\hz_fy\xmlmiddle\50313A\RQDTL.mfd

D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore\resources\msg\RQDTLW00020.mfd
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore\resources\msg\RQDTLW00021.mfd
	接收报文：
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\ZJYW\hz_fy\xmlmiddle\50313A\RSP_503408.mfd

D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore\resources\msg\OUTPUT\W00020.mfd
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore\resources\msg\OUTPUT\W00021.mfd
	sod文件：
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_middle_sod\operations\ZJYW\hz_fuyang\xmlmiddle\50313A.sod

D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore_sod\operat
ions\W00020.sod
D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_InternetCore_sod\operations\W00021.sod

BIP:
	trade.middle.localmid.hz.fuyang.xmlmiddle.t9850002
~~~





## 三、乌当镇银行水费业务需求开发

	需求开发资源整理
	
	参考交易：trade.middle.localmid.wz.lucheng.t503098 开阳水费单笔缴费
	
	trade.base.commontrade.CommonTrade
	
	可用柜员号：8510015
	
	一轮测到缴费，还没打版



​	
​	新建交易
​	
​	所用到的文件：
​	
​	1.用水信息查询 交易码503408
​	BSP:
​		发送报文：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\503408\RQDTL.mfd
​		接收报文：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_MiddleCom\resources\msg\503408\RSP_503408.mfd
​		sod文件：D:\SoftWare\Bsp_IDE_2.1.2\workspace\zjnx\app\bsp_middle_sod\operations\503408.sod
​	
	BIP:
		trade.middle.localmid.wz.lucheng.t503408 （四个文件）
	
	缴费方式：现金、卡号、账号

~~~java
//		String znj = "", ljznj = "", tot_znj = "", ysje = "", ljclf = "", tot_ysje = "", qfzje = "";
//		int rec_num = t_503408Out_loop.getRowCount();
//		for (int i = 0; i < rec_num; i++) {
//			znj = (String) t_503408Out_loop.getCellContentByColumnName(i,
//					"BkLate"); // 滞纳金
//			ljznj = (String) t_503408Out_loop.getCellContentByColumnName(i,
//					"BkAmt3"); // 垃圾处理滞纳金
//			tot_znj = MathUtil.addBigDecimal(
//					MathUtil.addBigDecimal(znj, ljznj), tot_znj); //滞纳金总金额
//			ysje = (String) t_503408Out_loop.getCellContentByColumnName(i,
//					"BkTxAmt"); // 应收金额
//			ljclf = (String) t_503408Out_loop.getCellContentByColumnName(i,
//					"BkAmt2"); // 垃圾处理费
//			tot_ysje = MathUtil.addBigDecimal(
//					MathUtil.addBigDecimal(ysje, ljclf), tot_ysje); //应收总金额
//		}
//		qfzje =MathUtil.addBigDecimal(tot_znj , tot_ysje);  // 欠费总金额
//		t_503408Out_BkAmt1_欠费总金额.setText(qfzje);
//		t_503408Out_BkAmt2_应收水费总额.setText(tot_ysje);
//		t_503408Out_BkAmt3_滞纳金总额.setText(tot_znj);
~~~







## 四、同业活期补录（练手）

~~~Markdown
已知起始日期为date1，终止日期为date2，要求两个日期的时间跨度不能超过一年半
	String date1 = dt_413341In_BDRASTDT_起始开户日期.getText()
    	.replaceAll("-", "");
    String date2 = dt_413341In_BDRAEDDT_终止开户日期.getText()
    	.replaceAll("-", "");
    Date dateByCount = DateUtil.getDateByCount(date1, 1, 6, 0);
    String dateFormat = DateUtil.getDateFormat(dateByCount, "yyyyMMdd");
    if (MathUtil.compare(dateFormat, date2) < 0) {
    	this.showInfo("时间跨度最多为一年，请重输！");
   		dt_413341In_BDRAEDDT_终止开户日期.setFocus();
   		dt_413341In_BDRAEDDT_终止开户日期.selectAll();
    }
~~~



## 五、财政非税业务优化需求（2020.09.22）

> #### 502017新增菜单

~~~markdown
	财政非税清算的时候，操作502017交易码需手工输入子账户和结算分户，人工输入易出错。为了确保财政资金划转正确性，故申请在交易码502017新增菜单，添加一个维护交易，实现财政子账户和结算户对应绑定，清算时柜员输入子账户账号就可以返显对应的结算户信息，无需手工输入。若不绑定，仍可以通过原方式手工输入。
~~~

~~~markdown
周二：
	新建了一个子账号与结算户绑定的维护交易：trade.middle.fsjk.t502012，等后台接口写好直接写通讯代码
	新建了一个交易码

YWXQ2020080028    非税账户升级
YWXQ2020080366	  财政非税业务优化
YWXQ2020090377    优化非税执收项目汇总表需求报告


可用交易柜员：801  8010007  8010020  8010025   502002非税业务资料维护

更改了公共资源middle.xml

替换报文：T502010改为T50201B  后台找吴兆丰问交易码

测试数据：
行政区划码 JXSCZJ 账号 222222222222222222222 
231000003468330       
231000003468330000002 
231000003468461       
231000003468461000111 
231000003468592 

二轮测试柜员号：8017010

~~~

![](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200922173507893.png)

![image-20200923090204132](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200923090204132.png)



~~~Markdown
问题：
	财政非税业务优化需求主要是在原非税业务资金清算交易的基础上优化一下，但是需要新建一个维护交易，需归里面没有写清楚，然后中间业务也没做这方面的接口
~~~



### 1.非税业务清算成功（交易码502012）

> 后台：吴兆丰
>
> 路径：trade.middle.fsjk.t502010.T502010
>
> 
>
> 验证环境可用柜员号： 
>
> 8010036    963852 
>
> 8010032    111111   
>
> 
>
> 准生产环境柜员号：8010794



上线的时候要删除

![image-20201014145218544](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201014145218544.png)

出现这个有可能是mapping没有配置或者上传到服务器

![image-20201012170323697](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201012170323697.png)



#### 存在问题：

1. .yuda文件导入报文时，查找不到sod文件，所以只能导入mfd文件（***事实证明尽量不要使用mfd进行映射，使用mfd后，要手动添加map数组数据***）



## 六、定期借记业务宁波地区优化需求

> 具有权限的柜员：8010291



## 七、舟山资金管理（2020.09.25）

~~~java
ENTRNO 就是  7380100981 7380100982 7380100983 

可用交易柜员号： 8010050
    
 做了个远程查询查询代理单位编号和代理单位名称
    
打印文件：
    凭证打印模板:
  D:\SoftWare\BIP_IDE_2.1.7\workspace\zjrc\yupt\middleyupt\middleyupt\50362001.yupt
    打印数据模板：
  D:\SoftWare\BIP_IDE_2.1.7\workspace\zjrc\cpdt\503620.cpdt
      
BIP文件：路径	/zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620
      
这是个全省交易，测试时可以设置所有都有
      
      

      
~~~

![image-20200930090800900](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200930090800900.png)



### 1、50362A对账

| 程序清单                                                     | 清单说明     |
| ------------------------------------------------------------ | ------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620/T503620.java | 主交易       |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620/T503620.yuda |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620/T503620.yuml |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503620/T503620Yuda.java |              |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362A/RQDTL.mfd | 请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362A/RSP_50362A.mfd | 响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362A.sod              | 界面数据映射 |
| /zjrc/cpdt/503620.cpdt                                       | 打印数据模板 |
| /zjrc/yupt/middleyupt/50362001.yupt                          | 凭证打印模板 |



### 2、50362B他行大额出金【有授权】

> 参考数据：1    20200929

| 程序清单                                                     | 清单说明           |
| :----------------------------------------------------------- | ------------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/T503621.java | 主交易             |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/T503621.yuda |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/T503621.yuml |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/T503621Yuda.java |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/t001/T001.java | 子交易             |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/t001/T001.yuda |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/t001/T001.yuml |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503621/t001/T001Yuda.java |                    |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362F/RQDTL.mfd | 主交易请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362F/RSP_50362F.mfd | 主交易响应报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362B/RQDTL.mfd | 子交易请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362B/RSP_50362B.mfd | 子交易响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362F.sod              | (主)界面数据映射   |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362B.sod              | （子）界面数据映射 |



### 3、50362C他行大额清算【有授权】

| 程序清单                                                     | 清单说明           |
| ------------------------------------------------------------ | ------------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/T503622.java | 主交易             |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/T503622.yuda |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/T503622.yuml |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/T503622Yuda.java |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/t001/T001.java | 子交易             |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/t001/T001.yuda |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/t001/T001.yuml |                    |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503622/t001/T001Yuda.java |                    |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362G/RQDTL.mfd | 主交易请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362G/RSP_50362G.mfd | 主交易响应报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362C/RQDTL.mfd | 子交易请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362C/RSP_50362C.mfd | 子交易响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362G.sod              | (主)界面数据映射   |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362C.sod              | （子）界面数据映射 |

数据：

7380100981-舟山资金监管1    20200929





### 4、50362D清算结果返回

| 程序清单                                                     | 清单说明     |
| ------------------------------------------------------------ | ------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503624/T503624.java | 主交易       |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503624/T503624.yuda |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503624/T503624.yuml |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503624/T503624Yuda.java |              |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362D/RQDTL.mfd | 请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362D/RSP_50362D.mfd | 响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362D.sod              | 界面数据映射 |
| /zjrc/cpdt/503624.cpdt                                       | 打印数据模板 |
| /zjrc/yupt/middleyupt/50362401.yupt                          | 凭证打印模板 |



### 5、50362E清算结果确认

| 程序清单                                                     | 清单说明     |
| ------------------------------------------------------------ | ------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503623/T503623.java | 主交易       |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503623/T503623.yuda |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503623/T503623.yuml |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503623/T503623Yuda.java |              |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362E/RQDTL.mfd | 请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362E/RSP_50362E.mfd | 响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362E.sod              | 界面数据映射 |



### 6、50362H对账确认

| 程序清单                                                     | 清单说明     |
| ------------------------------------------------------------ | ------------ |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503625/T503625.java | 主交易       |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503625/T503625.yuda |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503625/T503625.yuml |              |
| /zjrc/src/trade/xmiddle/localmid/zs/sczjjg/t503625/T503625Yuda.java |              |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362H/RQDTL.mfd | 请求报文     |
| /zjnx/app/bsp_MiddleCom/resources/msg/xmiddle/50362H/RSP_50362H.mfd | 响应报文     |
| /zjnx/app/bsp_Xmiddle_sod/operations/50362H.sod              | 界面数据映射 |
| /zjrc/cpdt/503625.cpdt                                       | 打印数据模板 |
| /zjrc/yupt/middleyupt/50362501.yupt                          | 凭证打印模板 |



### 存在问题:

1. BSPC通讯成功但没有数据

   两种原因：1.后台给的数据有问题   2.渠道转发地址有误，找陈功昊或刘刚问一下，

![image-20200930171313171](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200930171313171.png)

2. 他行大额清算的流水号和清算行名没有返回数据

   这个还要确定一下是什么流水号，和你前端的程序没关系，用BkListNo1就行了

   流水号原来的程序就没赋值，反正你从BkListNo1取好了，到时我空了再看看

![image-20200930171500021](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200930171500021.png)

![image-20200930171515635](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200930171515635.png)

3. ![image-20200930171603446](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20200930171603446.png)



### 未完成任务：

1. 需求中的5.1.5 发起清算，清算结果返回和清算结果确认
2. 恒信财政非税业务需求需要变更，等待变更后的需求和接口



## 八、优化非税执收项目汇总表需求报告（报表类）【2020.10.15 】

> 需求文档在企业微信陈荣
>
> 主要是在老交易502010里添加一个报表类型为  9-功能科目执收项目汇总表
>
> 可用柜员号：8010025   8010424  8017010
>
> 后台：吴兆丰
>
> 测试数据：
>
> 报表日期： 20160101   -    20160130
>
> 报表类型：9    行政区划编码330000   其余不填
>
> 
>
> 二轮测试柜员号：8010260  、8010370、8010829、8010021



### 交易代码：

BIP：

1. 路径	/zjrc/src/trade/middle/fsjk/t502009/T502009.java
2. 路径	/zjrc/src/trade/middle/fsjk/t502009/T502009.yuda
3. 路径	/zjrc/src/trade/middle/fsjk/t502009/T502009.yuml
4. 路径	/zjrc/src/trade/middle/fsjk/t502009/T502009Yuda.java

报文不用变动

公共资源：

​	1. 路径	/zjrc/resource/para/dataSource/middle.xml （修改之前已经更新到70745版本）



存在问题：

1. 远程查询方法中：Remote_TcpQuery、Remote_TcpQuery2、Remote_TcpQuery3三者有什么区别
2. 为什么没有建应答报文，还能获取数据呢？
3. 如果打印名称为空以及显示“请插入【null】，按回车键打印”，说明.cpdt文件中打印标题没有写，打印类型没写报表打印，是否分页未选择true





### 非税基础资料下载交易

新建502028交易

新建mapping ： 交易与服务名 、 交易是否走TCP

![image-20201020101632899](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201020101632899.png)![image-20201020101641555](C:\Users\ZJRCU\AppData\Roaming\Typora\typora-user-images\image-20201020101641555.png)



测试环境和验证环境都添加了502028交易码

BIP：

1. 路径	/zjrc/src/trade/middle/fsjk/t502028/T502028.java
2. 路径	/zjrc/src/trade/middle/fsjk/t502028/T502028.yuda
3. 路径	/zjrc/src/trade/middle/fsjk/t502028/T502028.yuml
4. 路径	/zjrc/src/trade/middle/fsjk/t502028/T502028Yuda.java